<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>猜瓶子</title>
    <style>
        body {
            ('dragstart', handleDragStart);
                tube.addEventListener('touchstart', handleTouchStart);
                availableTubesContainer.appendChild(tube);
            });
        }

        function renderCorrectSequence() {
            correctSequenceContainer.innerHTML = '';
            targetSequence.forEach(color => {
                const tube = createTubeElement(color);
                correctSequenceContainer.appendChild(tube);
            });
        }

        function createTubeElement(color) {
            const tube = document.createElement('div');
            tube.classList.add('test-tube', color);

            const liquid = document.createElement('div');
            liquid.classList.add('liquid');
            tube.appendChild(liquid);

            return tube;
        }

        function handleDragStart(e) {
            e.dataTransfer.setData('color', e.target.classList[1]);
        }

        function handleTouchStart(e) {
            e.preventDefault();
            const color = e.target.classList[1];
            e.target.setAttribute('data-color', color);
            e.target.classList.add('dragging');
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('over');
        }

        function handleDrop(e, index) {
            e.preventDefault();
            const color = e.dataTransfer.getData('color');

            // 替换当前格子中的瓶子
            if (color) {
                playerSequence[index] = color;
                renderSortingArea();
                provideFeedback(color, index);
            }
        }

        function handleTouchEnd(e, index) {
            const color = e.target.getAttribute('data-color');

            // 替换当前格子中的瓶子
            if (color) {
                playerSequence[index] = color;
                renderSortingArea();
                provideFeedback(color, index);
            }
        }

        function provideFeedback(color, index) {
            const row = Math.floor(index / 6);
            const rowStart = row * 6;
            const rowEnd = rowStart + 6;
            const currentRow = targetSequence.slice(rowStart, rowEnd);

            if (color === targetSequence[index]) {
                feedbackMessage.textContent = '位置正确！';
                feedbackMessage.style.color = 'green';
            } else if (currentRow.includes(color)) {
                feedbackMessage.textContent = '颜色存在，但位置不正确。';
                feedbackMessage.style.color = 'orange';
            } else {
                feedbackMessage.textContent = '颜色不存在！';
                feedbackMessage.style.color = 'red';
            }
        }

        function retryLevel() {
            playerSequence = Array(playerSequence.length).fill(null);
            renderSortingArea();
            feedbackMessage.textContent = '';
            resultContainer.textContent = '';
        }

        function nextLevel() {
            if (currentLevel < levels.length - 1) {
                currentLevel++;
                initLevel(currentLevel);
            } else {
                resultContainer.textContent = '你已完成所有关卡！';
            }
        }

        retryButton.addEventListener('click', retryLevel);
        nextLevelButton.addEventListener('click', nextLevel);

        initLevel(currentLevel);
    </script>
</body>
</html>
