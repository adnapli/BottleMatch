    function handleTouchStart(e, element, color) {
        e.preventDefault();
        draggedElement = element.cloneNode(true);
        draggedElement.classList.add('dragging');
        document.body.appendChild(draggedElement);
        draggedColor = color;

        // 增加放置区域的标记
        document.querySelectorAll('.drop-zone').forEach(zone => {
            zone.classList.add('over');
        });
    }

    function handleTouchMove(e) {
        e.preventDefault();
        if (!draggedElement) return;

        const touch = e.touches[0];
        draggedElement.style.left = `${touch.clientX - draggedElement.offsetWidth / 2}px`;
        draggedElement.style.top = `${touch.clientY - draggedElement.offsetHeight / 2}px`;
    }

    function handleTouchEnd(e, index = null) {
        if (draggedElement) {
            const touch = e.changedTouches[0];
            const dropZones = document.elementsFromPoint(touch.clientX, touch.clientY);
            const targetZone = dropZones.find(zone => zone.classList.contains('drop-zone'));

            // 移除放置区域的标记
            document.querySelectorAll('.drop-zone').forEach(zone => {
                zone.classList.remove('over');
            });

            if (targetZone) {
                const zoneIndex = Array.from(sortingArea.children).indexOf(targetZone);
                playerSequence[zoneIndex] = draggedColor;
                renderSortingArea();
                provideFeedback(draggedColor, zoneIndex);
            }

            draggedElement.remove();
            draggedElement = null;
        }
    }

    function provideFeedback(color, index) {
        const row = Math.floor(index / 6);
        const rowStart = row * 6;
        const rowEnd = rowStart + 6;
        const currentRow = targetSequence.slice(rowStart, rowEnd);

        if (color === targetSequence[index]) {
            feedbackMessage.textContent = '位置正确！';
            feedbackMessage.style.color = 'green';
        } else if (currentRow.includes(color)) {
            feedbackMessage.textContent = '颜色存在，但位置不正确。';
            feedbackMessage.style.color = 'orange';
        } else {
            feedbackMessage.textContent = '颜色不存在！';
            feedbackMessage.style.color = 'red';
        }
    }

    function retryLevel() {
        playerSequence = Array(playerSequence.length).fill(null);
        renderSortingArea();
        feedbackMessage.textContent = '';
    }

    function nextLevel() {
        if (currentLevel < levels.length - 1) {
            currentLevel++;
            initLevel(currentLevel);
        } else {
            feedbackMessage.textContent = '你已完成所有关卡！';
        }
    }

    retryButton.addEventListener('click', retryLevel);
    nextLevelButton.addEventListener('click', nextLevel);

    initLevel(currentLevel);
</script>
